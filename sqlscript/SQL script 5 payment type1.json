{
	"name": "SQL script 5 payment type1",
	"properties": {
		"content": {
			"query": "USE nyc_taxi_discovery\n\n-- 1. JSON File (Single line)\n-- Do not identify Parser_version and header_row for JSON file\n-- Step 1. Read file JSON \nSELECT \n    *\n    FROM OPENROWSET(\n        BULK 'payment_type.json',\n        DATA_SOURCE = 'nyc_taxi_raw',\n        FORMAT = 'csv',\n        PARSER_VERSION = '1.0', --(optional)\n        FIELDTERMINATOR = '0x0b', --vertical tab\n        FIELDQUOTE = '0x0b',\n        ROWTERMINATOR = '0x0a' -- new line(default)\n    ) WITH(\n        jsonDoc NVARCHAR(MAX)\n    )AS payment_type;\n\n\n-- Step 2. Use JSON function: JSON_VALUE( json file , property )\nSELECT JSON_VALUE(jsonDoc, '$.payment_type') AS payment_type,\n        JSON_VALUE(jsonDoc, '$.payment_type_desc') payment_type_desc\n    FROM OPENROWSET(\n        BULK 'payment_type.json',\n        DATA_SOURCE = 'nyc_taxi_raw',\n        FORMAT = 'csv',\n        PARSER_VERSION = '1.0', --(optional)\n        FIELDTERMINATOR = '0x0b', --vertical tab\n        FIELDQUOTE = '0x0b',\n        ROWTERMINATOR = '0x0a' -- new line(default)\n    ) WITH(\n        jsonDoc NVARCHAR(MAX)\n    )AS payment_type;\n\n-- Step 3. Specify Type of data, Use CAST function\nSELECT CAST(JSON_VALUE(jsonDoc, '$.payment_type') AS SMALLINT) AS payment_type,\n        CAST(JSON_VALUE(jsonDoc, '$.payment_type_desc') AS VARCHAR(15) ) payment_type_desc\n    FROM OPENROWSET(\n        BULK 'payment_type.json',\n        DATA_SOURCE = 'nyc_taxi_raw',\n        FORMAT = 'csv',\n        PARSER_VERSION = '1.0', --(optional)\n        FIELDTERMINATOR = '0x0b', --vertical tab\n        FIELDQUOTE = '0x0b',\n        ROWTERMINATOR = '0x0a' -- new line(default)\n    ) WITH(\n        jsonDoc NVARCHAR(MAX)\n    )AS payment_type;\n\n--JSON_VALUE function's limitation - It's is difficult to specify the data type, which we need to use CAST function\n--JSON_VALUE function's limitation - If JSON file has an array - it can't explore an entire array.\n\n-- 2. JSON File (Single line)\n-- use OPENJSON function -- It's more powerful than JSON_VALUE\n--Step 1: Use OPENJSON(JSONfile)\nSELECT * \n    FROM OPENROWSET(\n        BULK 'payment_type.json',\n        DATA_SOURCE = 'nyc_taxi_raw',\n        FORMAT = 'csv',\n        FIELDTERMINATOR = '0x0b', --vertical tab\n        FIELDQUOTE = '0x0b'\n    ) WITH(\n        jsonDoc NVARCHAR(MAX)\n    )AS payment_type\n    CROSS APPLY OPENJSON(jsonDoc);\n\n--Step 2: Specify data type by using WITH clause\nSELECT * \n    FROM OPENROWSET(\n        BULK 'payment_type.json',\n        DATA_SOURCE = 'nyc_taxi_raw',\n        FORMAT = 'csv',\n        FIELDTERMINATOR = '0x0b', --vertical tab\n        FIELDQUOTE = '0x0b'\n    ) WITH(\n        jsonDoc NVARCHAR(MAX)\n    )AS payment_type\n    CROSS APPLY OPENJSON(jsonDoc)\n    WITH(\n        payment_type SMALLINT,\n        payment_type_desc VARCHAR(20)\n    );\n\n-- Step 3 Specify Column that we need in SELECT clause\nSELECT payment_type, payment_type_desc \n    FROM OPENROWSET(\n        BULK 'payment_type.json',\n        DATA_SOURCE = 'nyc_taxi_raw',\n        FORMAT = 'csv',\n        FIELDTERMINATOR = '0x0b', --vertical tab\n        FIELDQUOTE = '0x0b'\n    ) WITH(\n        jsonDoc NVARCHAR(MAX)\n    )AS payment_type\n    CROSS APPLY OPENJSON(jsonDoc)\n    WITH(\n        payment_type SMALLINT,\n        payment_type_desc VARCHAR(20)\n    );\n\n-- Step 4 Rename column name\nSELECT payment_type, description \n    FROM OPENROWSET(\n        BULK 'payment_type.json',\n        DATA_SOURCE = 'nyc_taxi_raw',\n        FORMAT = 'csv',\n        FIELDTERMINATOR = '0x0b', --vertical tab\n        FIELDQUOTE = '0x0b'\n    ) WITH(\n        jsonDoc NVARCHAR(MAX)\n    )AS payment_type\n    CROSS APPLY OPENJSON(jsonDoc)\n    WITH(\n        payment_type SMALLINT,\n        description VARCHAR(20) '$.payment_type_desc'\n    );",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "master",
				"poolName": "Built-in"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}